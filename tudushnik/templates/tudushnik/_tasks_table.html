{% load custom_filters %}


<table class="tasks_table">
    <tbody>
    <tr>
        <th>

        </th>
        <th>
            <div>Участники</div>
            {#            {{ 'id'|create_table_column_search_and_sorting_widget:3 }}#}
            <table>
                <tr>
                    <td class="user_role_responsible">
                        Res
                    </td>
                    <td class="user_role_accountable">
                        Acc
                    </td>
                </tr>
                <tr>
                    <td class="user_role_consult">
                        Con
                    </td>
                    <td class="user_role_inform">
                        Inf
                    </td>
                </tr>
            </table>
        </th>

        <th>
            <div>Готово?</div>
            <binary-filter-widget
                    data-field-name="is_done"></binary-filter-widget>
        </th>
        {#        <th>#}
        {#            <div>Проект</div>#}
        {#            {{ 'project__title'|create_table_column_search_and_sorting_widget:3 }}#}
        {#        </th>#}
        <th>
            <div>Название</div>
            <search-widget-component data-field-name="title"
                                     size="3"></search-widget-component>
            <sorting-widget data-field-name="title"></sorting-widget>
        </th>
        <th>
            <div>Описание</div>
            <search-widget-component data-field-name="content"
                                     size="3"></search-widget-component>
            <sorting-widget data-field-name="content"></sorting-widget>
        </th>
        <th>
            <div>Создана</div>
            <search-widget-component data-field-name="created_at"
                                     size="3"></search-widget-component>
            <sorting-widget data-field-name="created_at"></sorting-widget>
        </th>
        <th>
            <div>Обновлена</div>
            <search-widget-component data-field-name="updated_at"
                                     size="3"></search-widget-component>
            <sorting-widget data-field-name="updated_at"></sorting-widget>
        </th>
        <th>
            <div>Начало</div>
            <search-widget-component data-field-name="begin_at"
                                     size="3"></search-widget-component>
            <sorting-widget data-field-name="begin_at"></sorting-widget>
        </th>
        <th>
            <div title="Продолжительность">Продолж.</div>
            <search-widget-component data-field-name="duration"
                                     size="3"></search-widget-component>
            <sorting-widget data-field-name="duration"></sorting-widget>
        </th>
        <th>
            <div>Тэги</div>
            {{ 'tags'|create_table_column_multi_filter_widget:all_tags }}

        </th>
    </tr>
    {% for item in page_obj %}
        <tr class="task-item-row">
            <td class="table_item_tools">
                <input type="checkbox">
                <a href="{% url 'task_detail' pk=item.pk %}">&#128065;</a>
                <button class="btn_item_delete"
                        data-item-title="{{ item.title }}"
                        data-entity-name="задачу"
                        {% if project_id %}
                        data-redirect-url="{% url 'project_detail' pk=project_id %}"
                        {% else %}
                        data-redirect-url="{% url 'tasks_page' %}"
                        {% endif %}
                        data-post-url="{% url 'task_delete' pk=item.pk %}">
                    &#x2715;
                </button>
                <a class="table_item_edit"
                   href="{% url 'task_edit' pk=item.pk %}">&#9998;</a>
            </td>
            <td class="task-item-id" data-task-id="{{ item.pk }}">
                <table>
                    <tr>
                        <td class="user_role_responsible">
                            <div class="ava_container">
                                {% for i in item.responsible.all %}
                                    <div class="ava_item_wrapper">
                                        <img src="{{ i.profile_settings.avatar.url }}"
                                             alt="responsible"
                                             class="user_avatar"
                                             title="{{ i }}">
                                    </div>
                                {% endfor %}
                            </div>
                        </td>
                        <td class="user_role_accountable">
                            <div class="ava_container">
                                <div class="ava_item_wrapper">
                                    <img src="{{ item.accountable.profile_settings.avatar.url }}"
                                         alt="accountable"
                                         class="user_avatar"
                                         title="{{ item.accountable }}">
                                </div>
                            </div>

                        </td>
                    </tr>
                    <tr>
                        <td class="user_role_consult">
                            <div class="ava_container">
                                {% for i in item.consultant.all %}
                                    <div class="ava_item_wrapper">
                                        <img src="{{ i.profile_settings.avatar.url }}"
                                             alt="consultant"
                                             class="user_avatar"
                                             title="{{ i }}">
                                    </div>
                                {% endfor %}
                            </div>
                        </td>
                        <td class="user_role_inform">
                            <div class="ava_container">
                                {% for i in item.informed.all %}
                                    <div class="ava_item_wrapper">
                                        <img src="{{ i.profile_settings.avatar.url }}"
                                             alt="informed"
                                             class="user_avatar"
                                             title="{{ i }}">
                                    </div>
                                {% endfor %}
                            </div>
                        </td>
                    </tr>
                </table>

            </td>

            <td class="task_item_done">
                <input type="checkbox" class="task-item-done" disabled
                        {% if item.is_done %}
                       checked="checked"
                        {% endif %}
                >
            </td>
            {#            <td>#}
            {#                <a href="{% url 'project_detail' item.project_id %}">#}
            {#                    {{ item.project }}</a>#}
            {#            </td>#}
            <td class="task_item_title">
                <div class="ellipsed_text_1">
                    <input type="text" value="{{ item.title }}">
                </div>
            </td>
            <td class="task_item_description">
                <div class="ellipsed_text_2">
                    {{ item.content|safe }}
                </div>
            </td>
            <td class="task_item_created_at">
                {{ item.created_at|date:'Y-m-d H:i' }}
            </td>
            <td class="task_item_updated_at">
                {{ item.updated_at|date:'Y-m-d H:i' }}
            </td>
            <td class="task_item_begin_at">
                {{ item.begin_at|date:'Y-m-d H:i' }}
                {#                {{ item.begin_at|localtime }}#}
            </td>
            <td class="task_item_duration">
                {{ item.duration|duration_humanize }}
            </td>
            <td class="task_item_tags">
                {% for item in item.tags.all %}
                    <span class="task_item_tag"
                          style="background-color: {{ item.color }}">{{ item.title }}</span>
                {% endfor %}
            </td>

        </tr>
    {% endfor %}
    </tbody>
</table>